
.weak
  WARNINGS :?= "None"
.endweak

GUARD_FE5_CHAPTER03 :?= false
.if (!GUARD_FE5_CHAPTER03)
  GUARD_FE5_CHAPTER03 := true

  ; Definitions

    .weak

      rlEventEngineCancelFading :?= address($8C8461)

    .endweak

  ; Freespace inclusions

    .section Chapter03EventsSection

      eventChapter03Events ; 8C/E435

        ; Flag definitions

          _FlagLobosBattleQuote     = enum.enum($06)

          ; TODO: map installer definitions

          _FlagDoor1                = enum.enum($21)
          _FlagDoor2                = enum.enum()
          _FlagDoor3                = enum.enum()
          _FlagDoor4                = enum.enum()
          _FlagDoor5                = enum.enum()
          _FlagDoor6                = enum.enum()
          _FlagDoor7                = enum.enum()
          _FlagChest1               = enum.enum()
          _FlagChest2               = enum.enum()
          _FlagRomeoHouseDestroy    = enum.enum()
          _FlagTailtiuHouseDestroy  = enum.enum()
          _FlagLucciaHouseDestroy   = enum.enum()
          _FlagJubelHouseDestroy    = enum.enum()
          _FlagTailtiuHouseVisit    = enum.enum()
          _FlagLucciaHouseVisit     = enum.enum()
          _FlagRomeoHouseVisit      = enum.enum()
          _FlagJubelHouseVisit      = enum.enum()
          _FlagDoor8                = enum.enum()
          _FlagDoor9                = enum.enum()

        _OpeningEventDefinitions ; 8C/E435
          EVENT FlagAlwaysZero, _OpeningEvent
            CMP_WORD wCurrentTurn, 0
          END_DEFINITION
        END_DEFINITION_ARRAY

        _TurnEventDefinitions ; 8C/E442
          EVENT FlagBossDeath, eventMapDeathQuoteDummyEvent
            CHECK_IF_BOSS_DEAD Lobos
            CMP_WORD wCurrentPhase, Enemy
          END_DEFINITION
          EVENT FlagAlwaysZero, _Brigand1Reinforcements
            CMP_WORD_RANGE wCurrentTurn, 10, 16
            CMP_WORD wCurrentPhase, Enemy
            ROLL_RNG 60
            TEST_FLAG_UNSET FlagBossDeath
          END_DEFINITION
          EVENT FlagAlwaysZero, _Brigand2Reinforcements
            CMP_WORD_RANGE wCurrentTurn, 10, 16
            CMP_WORD wCurrentPhase, Enemy
            ROLL_RNG 60
            TEST_FLAG_UNSET FlagBossDeath
          END_DEFINITION
          EVENT FlagAlwaysZero, _SoldierReinforcements
            CMP_WORD_RANGE wCurrentTurn, 14, 16
            CMP_WORD wCurrentPhase, Enemy
            ROLL_RNG 75
            TEST_FLAG_UNSET FlagBossDeath
          END_DEFINITION
          EVENT FlagAlwaysZero, _ArmorReinforcements
            CMP_WORD_RANGE wCurrentTurn, 11, 17
            CMP_WORD wCurrentPhase, Enemy
            ROLL_RNG 50
            TEST_FLAG_UNSET $02
          END_DEFINITION
        END_DEFINITION_ARRAY

        _TalkEventDefinitions ; 8C/E4AE
        END_DEFINITION_ARRAY

        _LocationEventDefinitions ; 8C/E4B0
          EVENT _FlagTailtiuHouseDestroy, _TailtiuHouseDestroy
            macroECCheckCoordinates [23, 22]
            CMP_WORD wCurrentPhase, Enemy
          END_DEFINITION
          EVENT _FlagTailtiuHouseVisit, _TailtiuHouseTailtiu
            CMP_WORD wCurrentPhase, Player
            CHECK_ACTIVE_CARRYING Tailtiu
            macroECCheckCoordinates [23, 22]
          END_DEFINITION
          EVENT FlagAlwaysZero, _TailtiuHouseOther
            CMP_WORD wCurrentPhase, Player
            TEST_FLAG_UNSET _FlagTailtiuHouseVisit
            macroECCheckCoordinates [23, 22]
          END_DEFINITION
          EVENT _FlagLucciaHouseDestroy, _LucciaHouseDestroy
            macroECCheckCoordinates [20, 27]
            CMP_WORD wCurrentPhase, Enemy
          END_DEFINITION
          EVENT _FlagLucciaHouseVisit, _LucciaHouseLuccia
            CMP_WORD wCurrentPhase, Player
            CHECK_ACTIVE_CARRYING Luccia
            macroECCheckCoordinates [20, 27]
          END_DEFINITION
          EVENT FlagAlwaysZero, _LucciaHouseOther
            CMP_WORD wCurrentPhase, Player
            TEST_FLAG_UNSET _FlagLucciaHouseVisit
            macroECCheckCoordinates [20, 27]
          END_DEFINITION
          EVENT _FlagRomeoHouseDestroy, _RomeoHouseDestroy
            macroECCheckCoordinates [20, 22]
            CMP_WORD wCurrentPhase, Enemy
          END_DEFINITION
          EVENT _FlagRomeoHouseVisit, _RomeoHouseRomeo
            CMP_WORD wCurrentPhase, Player
            CHECK_ACTIVE_CARRYING Romeo
            macroECCheckCoordinates [20, 22]
          END_DEFINITION
          EVENT FlagAlwaysZero, _RomeoHouseOther
            CMP_WORD wCurrentPhase, Player
            TEST_FLAG_UNSET _FlagRomeoHouseVisit
            macroECCheckCoordinates [20, 22]
          END_DEFINITION
          EVENT _FlagJubelHouseDestroy, _JubelHouseDestroy
            macroECCheckCoordinates [23, 27]
            CMP_WORD wCurrentPhase, Enemy
          END_DEFINITION
          EVENT _FlagJubelHouseVisit, _JubelHouseJubel
            CMP_WORD wCurrentPhase, Player
            CHECK_ACTIVE_CARRYING Jubel
            macroECCheckCoordinates [23, 27]
          END_DEFINITION
          EVENT FlagAlwaysZero, _JubelHouseOther
            CMP_WORD wCurrentPhase, Player
            TEST_FLAG_UNSET _FlagJubelHouseVisit
            macroECCheckCoordinates [23, 27]
          END_DEFINITION
          macroECDoor _FlagDoor1, [12, 11], _Door1
          macroECDoor _FlagDoor2, [13, 9], _Door2
          macroECDoor _FlagDoor3, [16, 8], _Door3
          macroECDoor _FlagDoor4, [22, 8], _Door4
          macroECDoor _FlagDoor5, [22, 4], _Door5
          macroECDoor _FlagDoor6, [2, 4], _Door6
          macroECDoor _FlagDoor7, [2, 8], _Door7
          macroECDoor _FlagDoor8, [9, 1], _Door8
          macroECDoor _FlagDoor9, [15, 1], _Door9
          macroECVanillaChest _FlagChest1, eventChapter03Data._Chest1
          macroECVanillaChest _FlagChest2, eventChapter03Data._Chest2
          EVENT FlagAlwaysZero, _EndingEvent
            macroECCheckCoordinates [12, 4]
            CMP_WORD wCurrentPhase, Player
            CMP_WORD aSelectedCharacterBuffer.Character, Leif
          END_DEFINITION
        END_DEFINITION_ARRAY

        _BeforeActionEventDefinitions ; 8C/E68A
        END_DEFINITION_ARRAY

        _AfterActionEventDefinitions ; 8C/E68C
        END_DEFINITION_ARRAY

        _BattleEventDefinitions ; 8C/E68E
          macroECBossQuote _FlagLobosBattleQuote, Lobos
        END_DEFINITION_ARRAY

        _ShopEventDefinitions ; 8C/E698
        END_DEFINITION_ARRAY

        _Brigand1Reinforcements ; 8C/E6AD
          SCROLL_CAMERA_ADDRESS eventChapter03Data._Brigand1ReinforcementsCameraCoordinates
          YIELD

          LOAD_GROUP_BLOCKABLE eventChapter03Data._Brigand1ReinforcementsGroup1
          WAIT_MOVE
          YIELD

          YIELD_UNK

          LOAD_GROUP_BLOCKABLE eventChapter03Data._Brigand1ReinforcementsGroup2
          WAIT_MOVE
          YIELD
        END2

        _Brigand2Reinforcements ; 8C/E6C0
          SCROLL_CAMERA_ADDRESS eventChapter03Data._Brigand2ReinforcementsCameraCoordinates
          YIELD

          LOAD_GROUP_BLOCKABLE eventChapter03Data._Brigand2ReinforcementsGroup1
          WAIT_MOVE
          YIELD

          YIELD_UNK

          LOAD_GROUP_BLOCKABLE eventChapter03Data._Brigand2ReinforcementsGroup2
          WAIT_MOVE
          YIELD
        END2

        _SoldierReinforcements ; 8C/E6D3
          SCROLL_CAMERA_ADDRESS eventChapter03Data._SoldierReinforcementsCameraCoordinates
          YIELD

          LOAD_GROUP_BLOCKABLE eventChapter03Data._SoldierReinforcementsGroup
          WAIT_MOVE
          YIELD

          YIELD_UNK
        END2

        _ArmorReinforcements ; 8C/E6E0
          SCROLL_CAMERA_ADDRESS eventChapter03Data._ArmorReinforcementsCameraCoordinates
          YIELD

          LOAD_GROUP_BLOCKABLE eventChapter03Data._ArmorReinforcementsGroup
          WAIT_MOVE
          YIELD

          YIELD_UNK
        END2

        _TailtiuHouseOther ; 8C/E6ED
        END2

        _TailtiuHouseTailtiu ; 8C/E6F6
          PLAY_SOUND_FORCED $00F7

          CALL_ASM_SKIPPABLE rlASMCClearActiveUnitRescue

          macroASMCRemoveUnit Tailtiu

          ADD_BYTE $7E4976, 1
          YIELD_UNK
          YIELD

          macroASMCSingleTileChangeByCoords [23, 22], $03F0

          SET_FLAG FlagTailtiuSaved
        END2

        _LucciaHouseOther ; 8C/E733
          macroDialogue dialogueChapter03LucciaHouseOther
        END2

        _LucciaHouseLuccia ; 8C/E73C
          PLAY_SOUND_FORCED $00F7

          CALL_ASM_LOOP rlASMCClearActiveUnitRescue

          macroASMCRemoveUnit Luccia

          ADD_BYTE $7E4976, 1
          YIELD_UNK
          YIELD_UNK

          DIALOGUE dialogueChapter03LucciaHouseLuccia
          YIELD

          macroASMCActiveUnitSetUnitState UnitStateHidden

          macroGiveActiveUnitItem BaldrsScroll

          macroASMCActiveUnitUnsetUnitState UnitStateHidden

          macroASMCSingleTileChangeByCoords [20, 27], $03F0
        END2

        _RomeoHouseOther ; 8C/E7B8
          macroDialogue dialogueChapter03RomeoHouseOther
        END2

        _RomeoHouseRomeo ; 8C/E7C1
          PLAY_SOUND_FORCED $00F7

          CALL_ASM_LOOP rlASMCClearActiveUnitRescue

          macroASMCRemoveUnit Romeo

          ADD_BYTE $7E4976, 1
          YIELD_UNK
          YIELD_UNK

          DIALOGUE dialogueChapter03RomeoHouseRomeo
          YIELD

          macroASMCActiveUnitSetUnitState UnitStateHidden

          macroGiveActiveUnitItem ShieldRing

          macroASMCActiveUnitUnsetUnitState UnitStateHidden

          macroASMCSingleTileChangeByCoords [20, 22], $03F0
        END2

        _JubelHouseOther ; 8C/E83D
          macroDialogue dialogueChapter03JubelHouseOther
        END2

        _JubelHouseJubel ; 8C/E846
          PLAY_SOUND_FORCED $00F7

          CALL_ASM_LOOP rlASMCClearActiveUnitRescue

          macroASMCRemoveUnit Jubel

          ADD_BYTE $7E4976, 1
          YIELD_UNK
          YIELD_UNK

          DIALOGUE dialogueChapter03JubelHouseJubel
          YIELD

          SET_FLAG FlagJubelSaved

          macroASMCSingleTileChangeByCoords [23, 27], $03F0
        END2

        _Door1 ; 8C/E883
          macroOpenDoorByTileChangeID 0
        END1

        _Door2 ; 8C/E8AE
          macroOpenDoorByTileChangeID 1
        END1

        _Door3 ; 8C/E8D9
          macroOpenDoorByTileChangeID 2
        END1

        _Door4 ; 8C/E904
          macroOpenDoorByTileChangeID 3
        END1

        _Door5 ; 8C/E92F
          macroOpenDoorByTileChangeID 4
        END1

        _Door6 ; 8C/E95A
          macroOpenDoorByTileChangeID 5
        END1

        _Door7 ; 8C/E985
          macroOpenDoorByTileChangeID 6
        END1

        _Door8 ; 8C/E9B0
          macroOpenDoorByTileChangeID 13
        END1

        _Door9 ; 8C/E9DB
          macroOpenDoorByTileChangeID 14
        END1

        _RomeoHouseDestroy ; 8C/EA06
          macroDestroyHouseByTileChangeID 9
        END1

        _TailtiuHouseDestroy ; 8C/EA35
          macroDestroyHouseByTileChangeID 10
        END1

        _LucciaHouseDestroy ; 8C/EA64
          macroDestroyHouseByTileChangeID 11
        END1

        _JubelHouseDestroy ; 8C/EA93
          macroDestroyHouseByTileChangeID 12
        END1

        _PrepGroups ; 8C/EAC2
        .word 0

        _OpeningEvent ; 8C/EAC4
          CALL_ASM_SKIPPABLE rlEventEngineCancelFading

          STORE_BYTE bBufferINIDISP, INIDISP_Setting(false, 0)

          SET_CAMERA_POSITION [13, 8]
          YIELD

          macroASMCAllUnitsSetUnitState (UnitStateUnknown1 | UnitStateHidden)
          macroASMCAllUnitsUnsetUnitState (UnitStateGrayed | UnitStateMovementStar | UnitStateMoved)

          macroLoadPlayerUnitsByStartingPositions

          LOAD_GROUP eventChapter03Data._NPCGroup
          WAIT_MOVE
          YIELD

          LOAD_GROUP eventChapter03Data._BossesGroup
          WAIT_MOVE
          YIELD

          LOAD_GROUP eventChapter03Data._BishopGroup
          WAIT_MOVE
          YIELD

          WAIT_MOVE
          YIELD

          FADE_IN 2

          HALT_UNTIL_BYTE_SKIPPABLE bBufferINIDISP, INIDISP_Setting(false, 15)

          PLAY_SOUND_FORCED $00E0
          PAUSE_SKIPPABLE 32
          YIELD

          FADE_IN 2 

          SET_CAMERA_POSITION [4, 34]
          YIELD

          macroASMCLoadUnitGroup eventChapter03Data._ch03cutsceneGroupB
          YIELD

          macroASMCDismount LeonsterBowKnight
          macroASMCDismount LeonsterLanceKnight

          LOAD_GROUP eventChapter03Data._ch03cutsceneGroupA
          WAIT_MOVE
          YIELD

          DIALOGUE dPrologueThreeStart1
          YIELD

          SCROLL_CAMERA_CHAR Ranz, 2
          YIELD

          DIALOGUE dPrologueThreeStart2
          YIELD

          SCROLL_CAMERA_COORDS [17, 39], 3

          MOVE_UNIT Ranz, [9, 30], [18, 26], 4, None
          YIELD_UNK

          MOVE_UNIT Dryas, [9, 30], [17, 26], 4, None
          YIELD_UNK

          MOVE_UNIT Xavier, [9, 30], [19, 26], 3, None
          YIELD_UNK

          WAIT_MOVE
          YIELD

          DIALOGUE dPrologueThreeStart3
          YIELD

          DIALOGUE dPrologueThreeStart4
          YIELD

          MOVE_UNIT Finn, [9, 30], [11, 26], 4, None
          YIELD_UNK

          MOVE_UNIT Selphina, [9, 30], [12, 27], 4, None
          YIELD_UNK

          MOVE_UNIT Glade, [9, 30], [11, 28], 3, None
          YIELD_UNK

          WAIT_MOVE
          YIELD

          SCROLL_CAMERA_CHAR Selphina, 1
          YIELD

          DIALOGUE dPrologueThreeStart5
          YIELD

          SCROLL_CAMERA_COORDS [17, 39], 3
          YIELD

          FADE_OUT 2
          YIELD

          macroASMCRemoveUnit Finn
          macroASMCRemoveUnit Glade
          macroASMCRemoveUnit Selphina
          ;macroASMCRemoveUnit Dryas
          macroASMCRemoveUnit Ranz
          macroASMCRemoveUnit Xavier
          macroASMCRemoveUnit LeonsterSoldier
          macroASMCRemoveUnit LeonsterMyrmidon
          macroASMCRemoveUnit LeonsterArcher
          macroASMCRemoveUnit LeonsterHero
          macroASMCRemoveUnit LeonsterBowKnight
          macroASMCRemoveUnit LeonsterLanceKnight

          YIELD


          SET_CAMERA_POSITION [1, 1]
          YIELD

          STORE_WORD wCurrentChapter, Chapter03
          CALL_ASM_SKIPPABLE $9A98B8

          SET_CAMERA_POSITION [1, 1]
          YIELD

          macroLoadPlayerUnitsByStartingPositions
          YIELD

          macroASMCLoadUnitGroup eventChapter03Data._NPCGroup

          WAIT_MOVE
          YIELD

          FADE_IN 2
        END2

        _EndingEvent ; 8C/EC8D
          STORE_WORD wCurrentMapMusic, $00

          PAUSE_SKIPPABLE 16
          YIELD

          CALL_ASM_LOOP rlASMCSaveActiveUnitClearHDMA
          CALL_ASM_LOOP rlASMCSaveChapterTurncount

          macroASMCSetUnitState Leif, UnitStateHidden

          macroDialogueWithBG dialogueChapter03Ending1, 1

          CALL_ASM_LOOP rlASMCDialogueWithBGEnd
          YIELD

          HALT_UNTIL_BYTE_SKIPPABLE bBufferINIDISP, INIDISP_Setting(false, 15)

          PLAY_SOUND_FORCED $00E0
          PAUSE_SKIPPABLE 32
          YIELD

          SET_MUSIC $42
          YIELD

          _EndingDialogueList  := [(Eyvel, dialogueChapter03Ending2)]
          _EndingDialogueList ..= [(Finn, dialogueChapter03Ending3)]
          _EndingDialogueList ..= [(Osian, dialogueChapter03Ending5)]
          _EndingDialogueList ..= [(Halvan, dialogueChapter03Ending4)]
          _EndingDialogueList ..= [(Safy, dialogueChapter03Ending6)]
          _EndingDialogueList ..= [(Dagdar, dialogueChapter03Ending7)]

          .for _DialogueChar, _DialoguePointer in _EndingDialogueList

            macroASMCCountAllUnitsRescuedByPlayerOrNPC _DialogueChar
            JUMP_FALSE +

              SCROLL_CAMERA_CHAR _DialogueChar, 4

              DIALOGUE _DialoguePointer
              YIELD

            +
          .endfor

          PLAY_SOUND_FORCED $00E7

          FADE_OUT 1
          YIELD

          STORE_BYTE bBufferINIDISP, INIDISP_Setting(false, 0)

          macroASMCUnsetUnitState Eyvel, UnitStateCaptured

          _UnitClearList  := [Eyvel, Finn, Osian, Halvan, Dagdar]
          _UnitClearList ..= [Marty, Ronan, Safy, Tanya]

          .for _Unit in _UnitClearList

            macroASMCCheckUnitStateSet _Unit, UnitStateCaptured
            JUMP_TRUE +

              macroASMCClearRescue _Unit

              macroASMCUnsetUnitState _Unit, (UnitStateGrayed | UnitStateMovementStar | UnitStateMoved | UnitStateUnknown2)
              macroASMCSetUnitState _Unit, (UnitStateHidden | UnitStateDisabled)

            +
          .endfor

          FADE_OUT 1
          YIELD

          CALL_ASM_LOOP rlASMCChapterEnd

        END1

    .endsection Chapter03EventsSection

    .section Chapter03DataSection

      eventChapter03Data ; B1/F318

<<<<<<< HEAD
        _UnusedCoordinates1 ; B1/F318
          .byte [11, 11]

        _NPCGroup
          UNIT Dryas, NPC, [7, 1], [7, 1], Dryas, [Longbow, ShortLance], 1, true, [$00, $00, $00, $00]
=======
        _ch03cutsceneGroupA
          UNIT Finn, Player, [2, 35], [8, 32], Dryas, [Javelin], 1, true, [$00, $00, $00, $00]
          UNIT Glade, Player, [1, 33], [6, 32], Dryas, [Rapier], 1, true, [$00, $00, $00, $00]
          UNIT Selphina, Player, [1, 36], [7, 33], Dryas, [Rapier], 1, true, [$00, $00, $00, $00]
        UNIT

        _ch03cutsceneGroupB
          UNIT Dryas, NPC, [7, 30], [7, 30], Dryas, [Javelin], 1, true, [$00, $00, $00, $00]
          UNIT Ranz, NPC, [9, 30], [9, 30], Dryas, [Rapier], 1, true, [$00, $00, $00, $00]
          UNIT Xavier, NPC, [5, 30], [5, 30], Dryas, [GreatLance], 1, true, [$00, $00, $00, $00]
          UNIT LeonsterSoldier, NPC, [7, 34], [7, 34], Dryas, [IronLance], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterMyrmidon, NPC, [6, 34], [6, 34], Dryas, [IronBlade], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterArcher, NPC, [8, 34], [8, 34], Dryas, [IronBow], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterHero, NPC, [6, 35], [6, 35], Dryas, [IronAxe], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterBowKnight, NPC, [7, 35], [7, 35], Dryas, [ShortBow], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterLanceKnight, NPC, [8, 35], [8, 35], Dryas, [SlimSword], 2, False, [$00, $01, $00, $00]
        UNIT

        _ch03NPCGroupfinal
          UNIT Dryas, NPC, [7, 1], [7, 1], Dryas, [Javelin], 1, true, [$01, $03, $00, $80]
          UNIT Ranz, NPC, [8, 1], [8, 1], Dryas, [Rapier], 1, true, [$01, $03, $00, $80]
          UNIT Xavier, NPC, [9, 1], [9, 1], Dryas, [GreatLance], 1, true, [$01, $03, $00, $80]
          UNIT LeonsterSoldier, NPC, [10, 5], [10, 5], Dryas, [IronLance], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterMyrmidon, NPC, [13, 10], [13, 10], Dryas, [IronBlade], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterArcher, NPC, [6, 5], [6, 5], Dryas, [IronBow], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterHero, NPC, [14, 2], [14, 2], Dryas, [IronAxe], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterBowKnight, NPC, [12, 5], [12, 5], Dryas, [ShortBow], 2, False, [$00, $01, $00, $00]
          UNIT LeonsterLanceKnight, NPC, [2, 11], [2, 11], Dryas, [SlimSword], 2, False, [$00, $01, $00, $00]
>>>>>>> d920ac1 (1.5.25)
        UNIT

        _StartingPositions ; B1/F5BC
          .byte [1, 1]
          .byte [1, 3]
          .byte [6, 1]
        .char -1

        _Chest1 VANILLA_CHEST Armorslayer, [11, 1] ; B1/F5D3
        _Chest2 VANILLA_CHEST Meteor, [13, 1] ; B1/F5D3

        _Vendor SHOP [2, 1], [Vulnerary, DoorKey] ; B1/F65B

    .endsection Chapter03DataSection

    .section Chapter03WorldMapEventsSection

      eventChapter03WorldMapEvents ; E7/E336

        SCROLL_CAMERA_COORDS [20, 14], 4
        SET_CURSOR_POSITION
        YIELD

        PLAY_SOUND_FORCED $00E0
        PAUSE_SKIPPABLE 32
        YIELD

        SET_MUSIC $29
        YIELD

        FADE_IN 1
        YIELD

        SCROLL_CAMERA_COORDS [20, 12], 1
        SET_CURSOR_POSITION
        YIELD

        macroWMSetCyclePalette 0, aBGPaletteBuffer.aPalette6

        macroWMDrawSpecialMarker [96, 80], WMMarkerTable.Crown, 0

        macroASMCWMDialogue dialogueChapter03WorldMap1
        HALT_UNTIL_WORD_SKIPPABLE wDialogueEngineStatus, $0000

        macroWMClearSpecialMarker 0

        PAUSE_SKIPPABLE 3
        YIELD

        macroWMDrawSpecialMarker [136, 112], WMMarkerTable.Circle, 0

        macroASMCWMDialogue dialogueChapter03WorldMap2
        HALT_UNTIL_WORD_SKIPPABLE wDialogueEngineStatus, $0000

        macroWMClearCyclePalette aBGPaletteBuffer.aPalette6

        macroWMClearSpecialMarker 0

        PAUSE_SKIPPABLE 1
        YIELD

        PAUSE_SKIPPABLE 1
        YIELD

        FADE_OUT 2
        YIELD

        CALL_ASM_LOOP rlASMCEndWMEvents
        YIELD
      END1

    .endsection Chapter03WorldMapEventsSection


.endif ; GUARD_FE5_CHAPTER03